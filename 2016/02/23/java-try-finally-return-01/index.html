<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="baidu-site-verification" content="xyDHnOQvLc" />



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="java,return,finally" />





  <link rel="alternate" href="/atom.xml" title="Hunter的博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="你真的了解try{ return }finally{}中的return?">
<meta property="og:type" content="article">
<meta property="og:title" content="你真的了解try{ return }finally{}中的return？">
<meta property="og:url" content="http://www.linmuxi.com/2016/02/23/java-try-finally-return-01/index.html">
<meta property="og:site_name" content="Hunter的博客">
<meta property="og:description" content="你真的了解try{ return }finally{}中的return?">
<meta property="og:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_01.png-hunterblog">
<meta property="og:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_02.png-hunterblog">
<meta property="og:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_03.png-hunterblog">
<meta property="og:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_04.png-hunterblog">
<meta property="og:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_05.png-hunterblog">
<meta property="og:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_06.png-hunterblog">
<meta property="og:updated_time" content="2017-02-07T08:45:10.660Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你真的了解try{ return }finally{}中的return？">
<meta name="twitter:description" content="你真的了解try{ return }finally{}中的return?">
<meta name="twitter:image" content="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_01.png-hunterblog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.linmuxi.com/2016/02/23/java-try-finally-return-01/"/>





  <title> 你真的了解try{ return }finally{}中的return？ | Hunter的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?a4f074d0c4eecf056150ecbd92e46f89";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hunter的博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">努力工作，幸福生活</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.linmuxi.com/2016/02/23/java-try-finally-return-01/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Hunter Lin">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://7xqlat.com1.z0.glb.clouddn.com/xigua_head.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hunter的博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Hunter的博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                你真的了解try{ return }finally{}中的return？
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-23T15:22:07+08:00">
                2016-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/02/23/java-try-finally-return-01/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/23/java-try-finally-return-01/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/02/23/java-try-finally-return-01/" class="leancloud_visitors" data-flag-title="你真的了解try{ return }finally{}中的return？">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          
              <div class="post-description">
                  你真的了解try{ return }finally{}中的return?
              </div>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>你真的了解try{ return }finally{}中的return？不妨点进来看看，说不定会有一定的小收获呢。<br><a id="more"></a><br>今天去逛论坛 时发现了一个很有趣的<a href="http://bbs.csdn.net/topics/391005556" target="_blank" rel="external">问题</a>：</p>
<blockquote>
<p>谁能给我我解释一下这段程序的结果为什么是：2.而不是：3</p>
</blockquote>
<p>代码如下：</p>
<pre><code class="java">class Test {
    public int aaa() {
        int x = 1;

        try {
            return ++x;
        } catch (Exception e) {

        } finally {
            ++x;
        }
        return x;
    }

    public static void main(String[] args) {
        Test t = new Test();
        int y = t.aaa();
        System.out.println(y);
    }
}
</code></pre>
<p>看了问题后，得出了以下几个问题：</p>
<ul>
<li>如果在 try 语句块里使用 return 语句，那么 finally 语句块还会执行吗？（如果你的答案是不会执行，请务必要看下去 ^_^）</li>
<li>如果执行，那么是怎样实现既执行 return 又执行 finally 的呢？（如果你的答案是不知道，请继续看下去！！）</li>
<li>上面的程序输出为什么是2？（ 如果不知道，继续看下去~~）</li>
<li>在网上看到还有人还问“是先执行return还是先执行finally？”的<br>（个人觉得，如果知道finally会执行就可以得出是，先执行finally再执行return的。因为，如果先执行return，那么整个函数都跳出了，那么还怎么执行finally？^_^）</li>
</ul>
<p>刚看到这个问题后。突然发现基础不够扎实，居然来第一个都答不出来。。。（不知道还有木有和我也一样也回答不出以上的问题的？ 如果有请在评论里告诉我一声，让我知道，我并不孤独~~）</p>
<p>根据已有的知识知道：</p>
<blockquote>
<p>return 是可以当作终止语句来用的，我们经常用它来跳出当前方法，并返回一个值给调用方法。然后该方法就结束了，不会执行return下面的语句。<br>finally ：无论try语句发生了什么，无论抛出异常还是正常执行。finally语句都会执行。<br>那么问题来了。。。。在try语句里使用return后，finally是否还会执行？finally一定会执行的说法是否还成立？如果成立，那么先执行return还是先执行finally？</p>
</blockquote>
<h3 id="验证-finally-语句是否会执行，以及-return-和-finally的执行顺序"><a href="#验证-finally-语句是否会执行，以及-return-和-finally的执行顺序" class="headerlink" title="验证 finally 语句是否会执行，以及 return 和 finally的执行顺序"></a><strong>验证 finally 语句是否会执行，以及 return 和 finally的执行顺序</strong></h3><p>在求知欲的驱动下，我继续进行更深的探索，果断打开了Oracle的主页，翻阅了<a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/finally.html" target="_blank" rel="external">java 官方教程的finally语句</a>。发现了官方教程对这个特殊情况有说明：</p>
<blockquote>
<p>The finally block always executes when the try block exits. This ensures that the finally block is executed even if an unexpected exception occurs. But finally is useful for more than just exception handling — it allows the programmer to avoid having cleanup code accidentally bypassed by a return, continue, or break. Putting cleanup code in a finally block is always a good practice, even when no exceptions are anticipated.</p>
<blockquote>
<p>Note: If the JVM exits while the try or catch code is being executed, then the finally block may not execute. Likewise, if the thread executing the try or catch code is interrupted or killed, the finally block may not execute even though the application as a whole continues.</p>
</blockquote>
</blockquote>
<p>个人简单翻译：</p>
<blockquote>
<p>当try语句退出时肯定会执行finally语句。这确保了即使发了一个意想不到的异常也会执行finally语句块。但是finally的用处不仅是用来处理异常——它可以让程序员不会因为return、continue、或者break语句而忽略了清理代码。把清理代码放在finally语句块里是一个很好的做法，即便可能不会有异常发生也要这样做。</p>
<blockquote>
<p>注意，当try或者catch的代码在运行的时候，JVM退出了。那么finally语句块就不会执行。同样，如果线程在运行try或者catch的代码时被中断了或者被杀死了(killed)，那么finally语句可能也不会执行了，即使整个运用还会继续执行。</p>
</blockquote>
</blockquote>
<p>从上面的官方说明，我们知道<strong>无论try里执行了return语句、break语句、还是continue语句，finally语句块还会继续执行</strong>。同时，在<a href="http://stackoverflow.com/questions/65035/does-finally-always-execute-in-java/65185#65185" target="_blank" rel="external">stackoverflow</a>里也找到了一个答案，我们可以调用System.exit()来终止它：</p>
<blockquote>
<p>finally will be called.<br>The only time finally won’t be called is: if you call System.exit(), another thread interrupts current one, or if the JVM crashes first</p>
</blockquote>
<p>另外，在<a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.17" target="_blank" rel="external">java的语言规范</a>有讲到，如果在try语句里有return语句，finally语句还是会执行。它会在把控制权转移到该方法的调用者或者构造器前执行finally语句。也就是说，使用return语句把控制权转移给其他的方法前会执行finally语句。</p>
<h3 id="个人验证"><a href="#个人验证" class="headerlink" title="个人验证"></a><strong>个人验证</strong></h3><p>我们依然使用上面的代码作为例子。首先，分别在以下三行代码前加上断点：</p>
<ul>
<li>int x = 1;</li>
<li>return ++x;</li>
<li>++x;</li>
</ul>
<p>然后以debug模式运行代码。</p>
<p>刚开始时，效果如下图：<br><img src="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_01.png-hunterblog" alt="">;<br>按一下F6，我们可以发现，程序已经执行到 return ++x;,但还没执行该语句，此刻x=1<br><img src="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_02.png-hunterblog" alt="">;<br>继续按一下F6，程序执行到 ++x;,但还没执行该语句，因此此时的x=2（刚执行完return ++x语句的++x，但没执行return）<br><img src="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_03.png-hunterblog" alt="">;<br>继续按一下F6，此时，我们发现程序又跳回到 return +xx 这一行，此刻x=3(执行了finally语句里的++x)<br><img src="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_04.png-hunterblog" alt="">;</p>
<p>从上面过程中可以看到，</p>
<ul>
<li>在 <strong>try</strong> 里 使用 <strong>return</strong> 还是会执行finally语句的（我们用debug的模式看到了程序会条件 finally语句里执行）</li>
<li>执行完finally语句才执行 return。为什么?从上面的图可以合理推理出return ++x是分开来执行的，先执行++x，再执行finally，最后才执行return跳出函数。因为程序调两次跳到了 return +xx; 语句上。（其实要验证 return ++x 是分开两部分执行的方法很简单，把变量x变成static变量并在main函数里输出，会发现x的值还是3，即使两次跳到 return ++x 也只是第一次执行了加1操作，第二次只是执行了return而没有执行++x。这里是合理推理，后面有真凭实据~~）</li>
</ul>
<p>看到这，我们可能会再次纠结起来了。从上面的验证可以看出，finally语句执行了，而且x的值也确实加到3了，那么为什么y是2呢？</p>
<h3 id="验证为什么是2不是3"><a href="#验证为什么是2不是3" class="headerlink" title="验证为什么是2不是3"></a><strong>验证为什么是2不是3</strong></h3><p>翻看<a href="http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.10.2.5" target="_blank" rel="external">官方的jvm规范</a>就会把一切的谜团解开了：</p>
<blockquote>
<p>If the try clause executes a return, the compiled code does the following:</p>
<ol>
<li>Saves the return value (if any) in a local variable.</li>
<li>Executes a jsr to the code for the finally clause.</li>
<li>Upon return from the finally clause, returns the value saved in the local variable.</li>
</ol>
</blockquote>
<p>简单翻译下：</p>
<blockquote>
<p>如果try语句里有return，那么代码的行为如下：</p>
<ol>
<li>如果有返回值，就把返回值保存到局部变量中</li>
<li>执行jsr指令跳到finally语句里执行</li>
<li>执行完finally语句后，返回之前保存在局部变量表里的值</li>
</ol>
</blockquote>
<p>根据上面的说明就可以轻易地解释为什么是2了。<br>当执行到return ++x;时，jvm在执行完++x后会在局部变量表里另外分配一个空间来保存当前x的值。<br>注意，现在还没把值返回给y，而是继续执行finally语句里的语句。等执行完后再把之前保存的值（是2不是x）返回给y。<br>所以就有了y是2不是3的情况。</p>
<p>其实这里还有一点要注意的是，如果你在finally里也用了return语句，比如return +xx。那么y会是3。因为规范规定了，当try和finally里都有return时，会忽略try的return，而使用finally的return。</p>
<p>查看Test.class的字节码我们同样也可以很轻松地知道为什么是2而不是3：<br><img src="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_05.png-hunterblog" alt="">;</p>
<p>大概讲讲指令操作顺序：<br>iconst_1： 把常数1进栈 —&gt; istore_1： 栈顶元素出栈并把元素保存在本地变量表的第二个位置里（下标为1的位置里） —&gt; iinc 1, 1 ： 本地变量表的第二个元素自增1 —&gt;iload_1：第二个元素进栈 —&gt; istore_2：栈顶元素出栈并把元素保存在本地变量表的第2个位置里 —&gt; iinc 1, 1 ： 本地变量表的第二个元素自增1 —&gt; iload_2：第二个元素进栈 （注意，此时栈顶元素为2）—&gt; ireturn：返回栈顶元素。</p>
<p>后面的指令是要在2-7行出现异常时在跳到12行的，这个例子没出现异常，不用关注。</p>
<p>上面流程栈和本地变量表的情况如下图：<br><img src="http://7xqlat.com1.z0.glb.clouddn.com/java_try_finally_return_06.png-hunterblog" alt="">;</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul>
<li>再次发现帮助别人解决问题的好处，不仅能帮人还能完善自己</li>
<li>字节码的知识还是挺实用的，有空要深入研究下</li>
<li>再次证明官方教程和资料真的很有用</li>
</ul>
<p>参考资料：<br><a href="http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-4.html#jvms-4.10.2.5" target="_blank" rel="external">Java虚拟机规范</a><br><a href="http://docs.oracle.com/javase/tutorial/essential/exceptions/finally.html" target="_blank" rel="external">java 官方教程的finally语句</a><br><a href="http://www.ibm.com/developerworks/library/it-haggar_bytecode/" target="_blank" rel="external">IBM的Java字节码教程</a><br><a href="http://book.douban.com/subject/24722612/" target="_blank" rel="external">深入理解Java虚拟机（第2版）</a></p>
<p><strong>本文转摘自：<a href="http://www.cnblogs.com/averey/p/4379646.html" target="_blank" rel="external">http://www.cnblogs.com/averey/p/4379646.html</a></strong></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/02/22/oracle-stream-01/" rel="next" title="Oracle单向高级流复制的使用">
                <i class="fa fa-chevron-left"></i> Oracle单向高级流复制的使用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/02/24/github-config-ssh/" rel="prev" title="Github之SSH连接配置">
                Github之SSH连接配置 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/02/23/java-try-finally-return-01/"
           data-title="你真的了解try{ return }finally{}中的return？" data-url="http://www.linmuxi.com/2016/02/23/java-try-finally-return-01/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xqlat.com1.z0.glb.clouddn.com/xigua_head.jpg"
               alt="Hunter Lin" />
          <p class="site-author-name" itemprop="name">Hunter Lin</p>
          <p class="site-description motion-element" itemprop="description">努力工作，幸福生活</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">65</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#验证-finally-语句是否会执行，以及-return-和-finally的执行顺序"><span class="nav-number">1.</span> <span class="nav-text">验证 finally 语句是否会执行，以及 return 和 finally的执行顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#个人验证"><span class="nav-number">2.</span> <span class="nav-text">个人验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证为什么是2不是3"><span class="nav-number">3.</span> <span class="nav-text">验证为什么是2不是3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hunter Lin</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"hunterlin"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("JjQ2qiKlwbIxVia8o02X4sce-gzGzoHsz", "J9bFS6tPJ9OJEWjQ3vFum55G");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
